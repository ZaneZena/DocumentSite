<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>#Mysql基础 | 清白之月</title>
    <meta name="description" content="你是否得到了期待的人生">
    <meta name="generator" content="VitePress v1.2.3">
    <link rel="preload stylesheet" href="/DocumentSite/assets/style.e5bvweht.css" as="style">
    
    <script type="module" src="/DocumentSite/assets/app.BUoif5yr.js"></script>
    <link rel="preload" href="/DocumentSite/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/DocumentSite/assets/chunks/framework.C_bjHMch.js">
    <link rel="modulepreload" href="/DocumentSite/assets/chunks/theme.BBvOqHMY.js">
    <link rel="modulepreload" href="/DocumentSite/assets/serverend_Mysql_index.md.Bjprq-wV.lean.js">
    <link rel="icon" href="./site.ico">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar has-sidebar top" data-v-ae24b3ad data-v-ccf7ddec><div class="wrapper" data-v-ccf7ddec><div class="container" data-v-ccf7ddec><div class="title" data-v-ccf7ddec><div class="VPNavBarTitle has-sidebar" data-v-ccf7ddec data-v-ab179fa1><a class="title" href="/DocumentSite/" data-v-ab179fa1><!--[--><!--]--><!--[--><img class="VPImage logo" src="/DocumentSite/hero-logo.svg" alt data-v-8426fc1a><!--]--><span data-v-ab179fa1>清白之月</span><!--[--><!--]--></a></div></div><div class="content" data-v-ccf7ddec><div class="content-body" data-v-ccf7ddec><!--[--><!--]--><div class="VPNavBarSearch search" data-v-ccf7ddec><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-ccf7ddec data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-b6c34ac9><span class="text" data-v-b6c34ac9><!----><span data-v-b6c34ac9>前端</span><span class="vpi-chevron-down text-icon" data-v-b6c34ac9></span></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/DocumentSite/frontend/vue2" data-v-43f1e123><!--[-->VUE 2.x<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/DocumentSite/frontend/vue3" data-v-43f1e123><!--[-->VUE 3.x<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-b6c34ac9><span class="text" data-v-b6c34ac9><!----><span data-v-b6c34ac9>服务端</span><span class="vpi-chevron-down text-icon" data-v-b6c34ac9></span></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/DocumentSite/serverend/Nodejs/index" data-v-43f1e123><!--[-->Nodejs<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/DocumentSite/serverend/mongodb" data-v-43f1e123><!--[-->Mongodb<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/DocumentSite/serverend/cloud-services/README" data-v-43f1e123><!--[-->云服务<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/DocumentSite/serverend/index" data-v-43f1e123><!--[-->Mysql<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/DocumentSite/serverend/docker" data-v-43f1e123><!--[-->Docker<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/DocumentSite/" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>工具类</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/DocumentSite/" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>前沿技术</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/DocumentSite/" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>随笔</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-ccf7ddec data-v-e6aabb21><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-e6aabb21 data-v-d1f28634 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-d1f28634></span><span class="vpi-moon moon" data-v-d1f28634></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-ccf7ddec data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://juejin.cn" aria-label target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb><svg t="1713408687091" class="icon" viewBox="0 0 1316 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7801" width="64" height="64"><path d="M643.181714 247.698286l154.916572-123.172572L643.181714 0.256 643.072 0l-154.660571 124.269714 154.660571 123.245715 0.109714 0.182857z m0 388.461714h0.109715l399.579428-315.245714-108.361143-87.04-291.218285 229.888h-0.146286l-0.109714 0.146285L351.817143 234.093714l-108.251429 87.04 399.433143 315.136 0.146286-0.146285z m-0.146285 215.552l0.146285-0.146286 534.893715-422.034285 108.397714 87.04-243.309714 192L643.145143 1024 10.422857 525.056 0 516.754286l108.251429-86.893715L643.035429 851.748571z" fill="#1E80FF" p-id="7802"></path></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-ccf7ddec data-v-d0bd9dde data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-b6c34ac9><span class="vpi-more-horizontal icon" data-v-b6c34ac9></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-d0bd9dde><div class="item appearance" data-v-d0bd9dde><p class="label" data-v-d0bd9dde>Appearance</p><div class="appearance-action" data-v-d0bd9dde><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-d0bd9dde data-v-d1f28634 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-d1f28634></span><span class="vpi-moon moon" data-v-d1f28634></span><!--]--></span></span></button></div></div></div><div class="group" data-v-d0bd9dde><div class="item social-links" data-v-d0bd9dde><div class="VPSocialLinks social-links-list" data-v-d0bd9dde data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://juejin.cn" aria-label target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb><svg t="1713408687091" class="icon" viewBox="0 0 1316 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7801" width="64" height="64"><path d="M643.181714 247.698286l154.916572-123.172572L643.181714 0.256 643.072 0l-154.660571 124.269714 154.660571 123.245715 0.109714 0.182857z m0 388.461714h0.109715l399.579428-315.245714-108.361143-87.04-291.218285 229.888h-0.146286l-0.109714 0.146285L351.817143 234.093714l-108.251429 87.04 399.433143 315.136 0.146286-0.146285z m-0.146285 215.552l0.146285-0.146286 534.893715-422.034285 108.397714 87.04-243.309714 192L643.145143 1024 10.422857 525.056 0 516.754286l108.251429-86.893715L643.035429 851.748571z" fill="#1E80FF" p-id="7802"></path></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-ccf7ddec data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-ccf7ddec><div class="divider-line" data-v-ccf7ddec></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-17a5e62e><button data-v-17a5e62e>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-575e6a36><div class="curtain" data-v-575e6a36></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-575e6a36><span class="visually-hidden" id="sidebar-aria-label" data-v-575e6a36> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0 collapsible" data-v-575e6a36 data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h2 class="text" data-v-b8d55f3b>前端</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b8d55f3b><span class="vpi-chevron-right caret-icon" data-v-b8d55f3b></span></div></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/DocumentSite/frontend/vue2" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Vue 2.x</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/DocumentSite/frontend/vue3" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Vue 3.x</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/DocumentSite/frontend/nodejs" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Nodejs</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0 collapsible" data-v-575e6a36 data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h2 class="text" data-v-b8d55f3b>服务端</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b8d55f3b><span class="vpi-chevron-right caret-icon" data-v-b8d55f3b></span></div></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/DocumentSite/serverend/README" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>README</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/DocumentSite/serverend/Nodejs/index" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Nodejs</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/DocumentSite/serverend/cloud-services/README" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>云服务</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/DocumentSite/serverend/mongodb" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Mongodb</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/DocumentSite/serverend/index" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Mysql</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/DocumentSite/serverend/docker" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Docker</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-575e6a36><div class="VPSidebarItem level-0 collapsible" data-v-575e6a36 data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><p class="text" data-v-b8d55f3b>工具类</p><!----></div><!----></div></div><div class="group" data-v-575e6a36><div class="VPSidebarItem level-0 collapsible" data-v-575e6a36 data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><p class="text" data-v-b8d55f3b>前沿技术</p><!----></div><!----></div></div><div class="group" data-v-575e6a36><div class="VPSidebarItem level-0 collapsible" data-v-575e6a36 data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><p class="text" data-v-b8d55f3b>随笔</p><!----></div><!----></div></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _DocumentSite_serverend_Mysql_" data-v-39a288b8><div><h1 id="mysql基础" tabindex="-1">#Mysql基础 <a class="header-anchor" href="#mysql基础" aria-label="Permalink to &quot;#Mysql基础&quot;">​</a></h1><p><a href="./mysql">Mysql常用查询语句呀</a></p><h1 id="一、mysql锁" tabindex="-1">一、mySQL锁 <a class="header-anchor" href="#一、mysql锁" aria-label="Permalink to &quot;一、mySQL锁&quot;">​</a></h1><blockquote><p>在我们平时开发中可能很少考虑锁的问题(特别是做前端的时候),这是因为数据库隐式帮我们添加了锁:</p><ul><li>对于<code>UPDATE、DELETE、INSERT</code>语句,InnoDB(<em>mySQL的数据库引擎之一,现为MySQL的默认存储引擎</em>)会自动将涉及的数据集添加 <strong>排他锁(X锁)</strong></li><li>事务拿到某一行记录的 <strong>共享锁(S锁)</strong> 才可以读取这一行,并阻止其他事务对其添加排他锁</li><li>事务拿到一行记录的 <strong>排他锁(X锁)</strong> 才可以修改或和删除这一行</li></ul><h5 id="共享锁的目的是为了提高读取的并发-排他锁的目的时为了保证数据的一致性" tabindex="-1">共享锁的目的是为了提高读取的并发;排他锁的目的时为了保证数据的一致性 <a class="header-anchor" href="#共享锁的目的是为了提高读取的并发-排他锁的目的时为了保证数据的一致性" aria-label="Permalink to &quot;共享锁的目的是为了提高读取的并发;排他锁的目的时为了保证数据的一致性&quot;">​</a></h5><p>我们在某些特定的场景下才需要手动进行加所,学习数据库锁知识就是为了:</p><ul><li>更好地控制程序代码</li><li>能让我们在特定场景上派上用场</li><li>构建自己的数据库知识体系</li></ul><p><img src="/DocumentSite/assets/image-20220319143229397.Ctgx1Oqe.png" alt="image-20220319143229397"></p></blockquote><h2 id="_1、悲观锁" tabindex="-1">1、悲观锁 <a class="header-anchor" href="#_1、悲观锁" aria-label="Permalink to &quot;1、悲观锁&quot;">​</a></h2><blockquote><p>悲观锁（Pessimistic Lock），顾名思义，就是很悲观，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会block直到它拿到锁。</p><ul><li>悲观锁：假定会发生并发冲突，屏蔽一切可能违反数据完整性的操作。</li><li>Java synchronized 就属于悲观锁的一种实现，每次线程要修改数据时都先获得锁，保证同一时刻只有一个线程能操作数据，其他线程则会被block。</li><li><code>共享锁</code>与<code>排他锁</code>都是<strong>悲观锁</strong>的范畴</li></ul></blockquote><h3 id="i-注意点" tabindex="-1">Ⅰ- 注意点 <a class="header-anchor" href="#i-注意点" aria-label="Permalink to &quot;Ⅰ- 注意点&quot;">​</a></h3><blockquote><p>要使用悲观锁我们就必须先关闭Mysql数据库的自动提交属性,因为Mysql默认使用 autocommit 模式</p><p>也就是说当你执行一个更新操作,Mysql会立即将结果进行提交</p><h6 id="排他锁与共享锁是悲观锁的不同实现-他们都属于悲观锁的范畴" tabindex="-1">排他锁与共享锁是悲观锁的不同实现,他们都属于悲观锁的范畴 <a class="header-anchor" href="#排他锁与共享锁是悲观锁的不同实现-他们都属于悲观锁的范畴" aria-label="Permalink to &quot;排他锁与共享锁是悲观锁的不同实现,他们都属于悲观锁的范畴&quot;">​</a></h6><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   * 更新库存(使用悲观锁)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> productId</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> boolean</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> updateStock</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Long productId){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       //先锁定商品库存记录</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       ProductStock product </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SELECT * FROM tb_product_stock WHERE product_id=#{productId} FOR UPDATE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, productId);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (product.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getNumber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">           int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> updateCnt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;UPDATE tb_product_stock SET number=number-1 WHERE product_id=#{productId}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, productId);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">           if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(updateCnt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//更新库存成功</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">               return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">           }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   }</span></span></code></pre></div></blockquote><h3 id="ii-排他锁" tabindex="-1">Ⅱ- 排他锁 <a class="header-anchor" href="#ii-排他锁" aria-label="Permalink to &quot;Ⅱ- 排他锁&quot;">​</a></h3><blockquote><p>排他锁与共享锁相对应,就是指对于多个不同事务,对同一个资源只能有一把锁,与共享锁类似,在需要执行的语句后面加上 <code>for update</code> 就可以了</p><ul><li>用域数据修改操作,例如:<code>UPDATE、DELETE、INSERT</code>语句.确保不会同时对同一资源进行多重更新</li><li>如果事务T对数据A加上排他锁后,则其他事务不能再对A加任何类型的封锁.</li><li>获准排他锁的数据技能读取数据还能修改数据</li></ul></blockquote><h3 id="iii-共享锁" tabindex="-1">Ⅲ - 共享锁 <a class="header-anchor" href="#iii-共享锁" aria-label="Permalink to &quot;Ⅲ - 共享锁&quot;">​</a></h3><blockquote><p><strong>共享锁(S锁)</strong> 用于不更改或不更新数据的操作(只读操作),例如<code>SELECT</code>语句</p><p>如果事务T对数据A加上共享锁后: <strong>其他事务只能对A再加共享锁,不能加排他锁.获准共享锁的事务只能读数据,不可修改数据</strong></p></blockquote><h4 id="举个栗子" tabindex="-1">举个栗子 <a class="header-anchor" href="#举个栗子" aria-label="Permalink to &quot;举个栗子&quot;">​</a></h4><blockquote><ol><li>开启共享锁</li></ol><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">begin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> city </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lock </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> share mode;</span></span></code></pre></div><ol start="2"><li>然后在另一个查询窗口中对id为1的数据进行更新</li></ol><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  city </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> name=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;努力学习的汪&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><ol start="3"><li>此时操作界面进入了卡顿状态,过了几秒也提示错误信息</li></ol><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[SQL]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  city </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> name=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;努力学习的汪&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[Err] </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1205</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Lock wait </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">timeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exceeded; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> restarting </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">transaction</span></span></code></pre></div><ol start="4"><li>如此就证明对于 <code>id=1</code> 的记录枷锁成功了:</li></ol><blockquote><p>在上一条记录还没有commmit之前,这条 <code>id=1</code>的记录被锁住了,只有在上一个事务书房掉锁后才能进行操作,或用共享锁才能对此数据进行操作</p></blockquote></blockquote><h2 id="_2、乐观锁" tabindex="-1">2、乐观锁 <a class="header-anchor" href="#_2、乐观锁" aria-label="Permalink to &quot;2、乐观锁&quot;">​</a></h2><blockquote><p>乐观锁（Optimistic Lock），顾名思义，就是很乐观，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在提交更新的时候会判断一下在此期间别人有没有去更新这个数据。乐观锁适用于读多写少的应用场景，这样可以提高吞吐量。</p><p>乐观锁：假设不会发生并发冲突，只在提交操作时检查是否违反数据完整性。</p></blockquote><h3 id="i-乐观锁的两种方式" tabindex="-1">Ⅰ - 乐观锁的两种方式 <a class="header-anchor" href="#i-乐观锁的两种方式" aria-label="Permalink to &quot;Ⅰ - 乐观锁的两种方式&quot;">​</a></h3><h4 id="_1-使用数据版本实现" tabindex="-1">① 使用数据版本实现 <a class="header-anchor" href="#_1-使用数据版本实现" aria-label="Permalink to &quot;① 使用数据版本实现&quot;">​</a></h4><blockquote><h6 id="使用数据版本-version-记录机制实现-这是乐观锁最常用的一种实现方式。何谓数据版本" tabindex="-1">使用数据版本（Version）记录机制实现，这是乐观锁最常用的一种实现方式。何谓数据版本？ <a class="header-anchor" href="#使用数据版本-version-记录机制实现-这是乐观锁最常用的一种实现方式。何谓数据版本" aria-label="Permalink to &quot;使用数据版本（Version）记录机制实现，这是乐观锁最常用的一种实现方式。何谓数据版本？&quot;">​</a></h6><ol><li>即为数据增加一个版本标识，一般是通过为数据库表增加一个数字类型的 “version” 字段来实现。</li><li>当读取数据时，将version字段的值一同读出，数据每更新一次，对此version值加一。</li><li>当我们提交更新的时候，判断数据库表对应记录的当前版本信息与第一次取出来的version值进行比对</li><li>如果数据库表当前版本号与第一次取出来的version值相等，则予以更新，否则认为是过期数据。</li></ol></blockquote><h4 id="_2-使用时间戳-timestamp" tabindex="-1">② 使用时间戳（timestamp） <a class="header-anchor" href="#_2-使用时间戳-timestamp" aria-label="Permalink to &quot;② 使用时间戳（timestamp）&quot;">​</a></h4><blockquote><p>乐观锁定的第二种实现方式和第一种差不多:</p><ol><li>同样是在需要乐观锁控制的table中增加一个字段，名称无所谓，字段类型使用时间戳（timestamp）</li><li>和上面的version类似，也是在更新提交的时候检查当前数据库中数据的时间戳和自己更新前取到的时间戳进行对比</li><li>如果一致则OK，否则就是版本冲突。</li></ol></blockquote><h3 id="ii-举个栗子" tabindex="-1">Ⅱ- 举个栗子 <a class="header-anchor" href="#ii-举个栗子" aria-label="Permalink to &quot;Ⅱ- 举个栗子&quot;">​</a></h3><blockquote><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    * 下单减库存</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> productId</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> boolean</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> updateStock</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Long productId){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> updateCnt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (updateCnt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">           ProductStock product </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SELECT * FROM tb_product_stock WHERE product_id=#{productId}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, productId);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">           if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (product.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getNumber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">               //这里进行判断,number需要等于number才能更新</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">               updateCnt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;UPDATE tb_product_stock SET number=number-1 WHERE product_id=#{productId} AND number=#{number}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, productId, product.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getNumber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">               if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(updateCnt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//更新库存成功</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                   return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">               }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">           } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//卖完啦</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">               return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">           }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   }</span></span></code></pre></div></blockquote><h2 id="_3、行锁" tabindex="-1">3、行锁 <a class="header-anchor" href="#_3、行锁" aria-label="Permalink to &quot;3、行锁&quot;">​</a></h2><blockquote><p>行锁，由字面意思理解，就是给某一行加上锁，也就是一条记录加上锁。</p><p>比如之前的共享锁语句</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> city </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lock </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> share mode;</span></span></code></pre></div><p>由于对于city表中,id字段为主键，就也相当于索引。执行加锁时，会将id这个索引为1的记录加上锁，那么这个锁就是行锁。</p><p>除此之外还有表锁,但不进行深入研究记录</p></blockquote><h3 id="i-innodb引擎的数据库状态查看-分析行锁" tabindex="-1">Ⅰ - InnoDB引擎的数据库状态查看（分析行锁） <a class="header-anchor" href="#i-innodb引擎的数据库状态查看-分析行锁" aria-label="Permalink to &quot;Ⅰ - InnoDB引擎的数据库状态查看（分析行锁）&quot;">​</a></h3><blockquote><p>通过检查InnoDB_row_lock状态变量来分析系统上的行锁的争夺情况</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">show </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> like</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;innodb_row_lock%&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>对于各个状态说明如下：</p><ul><li><code>Innodb_row_lock_current_waits</code>: 当前正在等待锁的数量；</li><li><code>Innodb_row_lock_time</code>: 从系统启动到现在锁定总时间长度；</li><li><code>Innodb_row_lock_time_avg</code>：每次等待所花平均时间；</li><li><code>Innodb_row_lock_time_max</code>: 从系统启动到现在等待最长的一次所花的时间长度；</li><li><code>Innodb_row_lock_waits</code>: 系统启动到现在总共等待的次数</li></ul></blockquote><h1 id="二、数据库设计" tabindex="-1">二、数据库设计 <a class="header-anchor" href="#二、数据库设计" aria-label="Permalink to &quot;二、数据库设计&quot;">​</a></h1><h2 id="_1、数据库设计三大范式" tabindex="-1">1、数据库设计三大范式 <a class="header-anchor" href="#_1、数据库设计三大范式" aria-label="Permalink to &quot;1、数据库设计三大范式&quot;">​</a></h2><blockquote><p>为了建立冗余较小、结构合理的数据库，设计数据库时必须遵循一定的规则。在关系型数据库中这种规则就称为范式。范式是符合某一种设计要求的总结。要想设计一个结构合理的关系型数据库，必须满足一定的范式。</p><ol><li>每一列只有一个值</li><li>每一行都能区分。</li><li>每一个表都不包含其他表已经包含的非主关键字信息。</li></ol></blockquote><h1 id="三、mysql相关的问题与解答" tabindex="-1">三、Mysql相关的问题与解答 <a class="header-anchor" href="#三、mysql相关的问题与解答" aria-label="Permalink to &quot;三、Mysql相关的问题与解答&quot;">​</a></h1><h2 id="_1、myisam索引底层是什么结构-b-tree" tabindex="-1">1、MyISAM索引底层是什么结构? --<code>B+ Tree</code> <a class="header-anchor" href="#_1、myisam索引底层是什么结构-b-tree" aria-label="Permalink to &quot;1、MyISAM索引底层是什么结构? --`B+ Tree`&quot;">​</a></h2><blockquote><h6 id="b-tree" tabindex="-1"><code>B+ Tree</code> <a class="header-anchor" href="#b-tree" aria-label="Permalink to &quot;`B+ Tree`&quot;">​</a></h6><p><strong>MyISAM索引文件和数据文件是分离的，索引文件仅保存数据记录的地址</strong>。而在InnoDB中，表数据文件本身就是按<code>B+Tree</code>组织的一个索引结构，这棵树的叶节点data域保存了完整的数据记录。这个索引的key是数据表的主键，因此InnoDB表数据文件本身就是主索引</p><p><img src="/DocumentSite/assets/image-20220319152214886.CPhUpqko.png" alt="image-20220319152214886"></p></blockquote><h2 id="_2、mysql如何解决脏读、不可重复读、幻读" tabindex="-1">2、MySQL如何解决脏读、不可重复读、幻读 <a class="header-anchor" href="#_2、mysql如何解决脏读、不可重复读、幻读" aria-label="Permalink to &quot;2、MySQL如何解决脏读、不可重复读、幻读&quot;">​</a></h2><h3 id="i-脏读" tabindex="-1">Ⅰ - 脏读 <a class="header-anchor" href="#i-脏读" aria-label="Permalink to &quot;Ⅰ - 脏读&quot;">​</a></h3><blockquote><h6 id="什么是脏读" tabindex="-1">什么是脏读? <a class="header-anchor" href="#什么是脏读" aria-label="Permalink to &quot;什么是脏读?&quot;">​</a></h6><p>脏读是指一个事务中访问到了另外一个事务未提交的数据</p><p><img src="/DocumentSite/assets/image-20220319152828490.Bkg9x2oY.png" alt="image-20220319152828490"></p><ul><li>如果会话2更新age到10,但是在commit之前会话1希望得到age: 那么会获得的值就是更新前的值</li><li>或者会话2更新了值但是执行了 <code>rollback</code>,而会话1拿到的仍是10,这就是脏读</li></ul></blockquote><h3 id="ii-幻读" tabindex="-1">Ⅱ - 幻读 <a class="header-anchor" href="#ii-幻读" aria-label="Permalink to &quot;Ⅱ - 幻读&quot;">​</a></h3><blockquote><p>一个事务读取2次,得到的记录条数不一致</p><p><img src="/DocumentSite/assets/image-20220319153140622.DVt6OkoQ.png" alt="image-20220319153140622"></p><p>上图很明显的表示了这个情况，由于在会话 1 之间插入了一个新的值，所以得到的两次数据就不一样了</p></blockquote><h3 id="iii-不可重复读" tabindex="-1">Ⅲ - 不可重复读 <a class="header-anchor" href="#iii-不可重复读" aria-label="Permalink to &quot;Ⅲ - 不可重复读&quot;">​</a></h3><blockquote><p>一个事务读取同一条记录2次,得到的结果不一致</p><p><img src="/DocumentSite/assets/image-20220319153324397.2PT7Quth.png" alt="image-20220319153324397"></p><p>由于在读取中间变更了数据，所以会话 1 事务查询期间的得到的结果就不一样了</p></blockquote><h3 id="iv-解决方案" tabindex="-1">Ⅳ - 解决方案 <a class="header-anchor" href="#iv-解决方案" aria-label="Permalink to &quot;Ⅳ - 解决方案&quot;">​</a></h3><blockquote><p>解决方案即是下面四种隔离级别,他们可以最大程度避免以上三种情况的发生</p></blockquote><h2 id="_3、mysql-数据隔离级别" tabindex="-1">3、MySQL 数据隔离级别 <a class="header-anchor" href="#_3、mysql-数据隔离级别" aria-label="Permalink to &quot;3、MySQL 数据隔离级别&quot;">​</a></h2><blockquote><p>MySQL 里有四个隔离级别：</p><ol><li>Read uncommttied(可以读取未提交数据)--未授权读取</li><li>Read committed(可以读取已提交数据) --授权读取</li><li>Repeatable read(可重复读) --可重复读取</li><li>Serializable(可串行化) --序列化</li></ol><h6 id="在-innodb-中-默认为-repeatable-级别-innodb-中使用一种被称为-next-key-locking-的策略来避免幻读-phantom-现象的产生" tabindex="-1">在 InnoDB 中，默认为 Repeatable 级别，InnoDB 中使用一种被称为 next-key locking 的策略来避免幻读(phantom)现象的产生 <a class="header-anchor" href="#在-innodb-中-默认为-repeatable-级别-innodb-中使用一种被称为-next-key-locking-的策略来避免幻读-phantom-现象的产生" aria-label="Permalink to &quot;在 InnoDB 中，默认为 Repeatable 级别，InnoDB 中使用一种被称为 next-key locking 的策略来避免幻读(phantom)现象的产生&quot;">​</a></h6><p>不同的事务隔离级别会导致不同的问题：</p><p><img src="/DocumentSite/assets/image-20220319153533049.C-NGkMzC.png" alt="image-20220319153533049"></p></blockquote><h3 id="i-read-uncommttied-未授权读取" tabindex="-1">Ⅰ - Read uncommttied--未授权读取 <a class="header-anchor" href="#i-read-uncommttied-未授权读取" aria-label="Permalink to &quot;Ⅰ - Read uncommttied--未授权读取&quot;">​</a></h3><blockquote><p>也称为读未提交(Read Uncommitted)：允许脏读取，但不允许更新丢失。</p><p>如果一个事务已经开始写数据，则另外一个事务则不允许同时进行写操作，但允许其他事务读此行数据。该隔离级别可以通过“排他写锁”实现</p></blockquote><h3 id="ii-read-committed-授权读取" tabindex="-1">Ⅱ - Read committed--授权读取 <a class="header-anchor" href="#ii-read-committed-授权读取" aria-label="Permalink to &quot;Ⅱ - Read committed--授权读取&quot;">​</a></h3><blockquote><p>也称为读提交(Read Committed)：允许不可重复读取，但不允许脏读取。</p><p>这可以通过“瞬间共享读锁”和“排他写锁”实现。读取数据的事务允许其他事务继续访问该行数据，但是未提交的写事务将会禁止其他事务访问该行。</p></blockquote><h3 id="iii-repeatable-read-可重复读取" tabindex="-1">Ⅲ - Repeatable read--可重复读取 <a class="header-anchor" href="#iii-repeatable-read-可重复读取" aria-label="Permalink to &quot;Ⅲ - Repeatable read--可重复读取&quot;">​</a></h3><blockquote><p>可重复读取(Repeatable Read)：禁止不可重复读取和脏读取，但是有时可能出现幻读数据。</p><p>这可以通过“共享读锁”和“排他写锁”实现。读取数据的事务将会禁止写事务(但允许读事务)，写事务则禁止任何其他事务。</p></blockquote><h3 id="iv-serializable-序列化" tabindex="-1">Ⅳ - Serializable--序列化 <a class="header-anchor" href="#iv-serializable-序列化" aria-label="Permalink to &quot;Ⅳ - Serializable--序列化&quot;">​</a></h3><blockquote><p>序列化(Serializable)：提供严格的事务隔离。它要求事务序列化执行，事务只能一个接着一个地执行，不能并发执行。</p><ul><li>仅仅通过“行级锁”是无法实现事务序列化的，必须通过其他机制保证新插入的数据不会被刚执行查询操作的事务访问到。</li><li>隔离级别越高，越能保证数据的完整性和一致性，但是对并发性能的影响也越大。</li><li>对于多数应用程序，可以优先考虑把数据库系统的隔离级别设为<code>Read Committed(授权读取)</code>。它能够避免脏读取，而且具有较好的并发性能。尽管它会导致不可重复读、幻读和第二类丢失更新这些并发问题，在可能出现这类问题的个别场合，可以由应用程序采用悲观锁或乐观锁来控制。</li></ul></blockquote><h1 id="四、常见的报错与解决" tabindex="-1">四、常见的报错与解决 <a class="header-anchor" href="#四、常见的报错与解决" aria-label="Permalink to &quot;四、常见的报错与解决&quot;">​</a></h1><h2 id="_1、解除输入的安全模式" tabindex="-1">1、解除输入的安全模式 <a class="header-anchor" href="#_1、解除输入的安全模式" aria-label="Permalink to &quot;1、解除输入的安全模式&quot;">​</a></h2><blockquote><ol><li><p>报错:<code>You are using safe update mode and you tried to update a table without a WHERE that uses a KEY column. To disable safe mode, toggle the option in Preferences -&gt; SQL Editor and reconnect. 0.000 sec</code></p></li><li><p>这是因为MySql运行在safe-updates模式下，该模式会导致非主键条件下<code>无法执行update或者delete命令</code>。</p></li><li><p>show variables like ‘SQL_SAFE_UPDATES’;查看开关状态。</p></li><li><p>执行命令SET SQL_SAFE_UPDATES = 0;修改下数据库模式</p><p><img src="/DocumentSite/assets/image-20210512185116624.6IfGtBJF.png" alt="image-20210512185116624"></p></li><li><p>至此可以正常修改了</p></li></ol></blockquote><h2 id="_2、忘记密码-修改密码" tabindex="-1">2、忘记密码 修改密码 <a class="header-anchor" href="#_2、忘记密码-修改密码" aria-label="Permalink to &quot;2、忘记密码 修改密码&quot;">​</a></h2><blockquote><ol><li><p>报错:<code>ERROR 1045 (28000): Access denied for user &#39;root&#39;@&#39;localhost&#39; (using password: YES)</code>,后面这个也可能是<code>password:NO</code></p></li><li><p>出现场景,这个问题总是在<code>Mysql8.0</code>版本出现,我们班很多同学都出现了这个问题,包括命名密码正确,但是就是无法读取链接数据库,这时就需要修改密码</p></li><li><p>此处给出一个个人觉得最简单的方法:</p></li><li><p>打开<code>服务</code>,找到``Mysql`服务,双击打开</p></li><li><p>如果<code>MysqlId</code>在运行,需要先关闭</p></li><li><p>直接在<code>登录</code>中修改密码</p></li><li><p>重启服务</p></li></ol><p><img src="/DocumentSite/assets/image-20210524173910554.CDXvTbFc.png" alt="image-20210524173910554"></p></blockquote></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-d4a0bba5><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-d4a0bba5><span class="visually-hidden" id="doc-footer-aria-label" data-v-d4a0bba5>Pager</span><div class="pager" data-v-d4a0bba5><!----></div><div class="pager" data-v-d4a0bba5><a class="VPLink link pager-link next" href="/DocumentSite/frontend/vue2" data-v-d4a0bba5><!--[--><span class="desc" data-v-d4a0bba5>Next page</span><span class="title" data-v-d4a0bba5>Vue 2.x</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-5d98c3a5 data-v-e315a0ad><div class="container" data-v-e315a0ad><p class="message" data-v-e315a0ad>As they floated in the breeze</p><p class="copyright" data-v-e315a0ad>Copyright © 2024-cheungchen</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"serverend_readme.md\":\"MT397xKZ\",\"serverend_mysql_index.md\":\"Bjprq-wV\",\"frontend_nodejs.md\":\"DzN0hYJa\",\"index.md\":\"Cc9kpmAi\",\"frontend_vue2.md\":\"DBwWAFcS\",\"serverend_cloud-services_云服务器安装node与mysql环境_readme.md\":\"CqX0o2Tc\",\"serverend_cloud-services_readme.md\":\"D7-SM6pF\",\"serverend_mysql_mysql.md\":\"ChmnkmfV\",\"serverend_cloud-services_云服务器安装node与mysql环境_云服务器进行node、mysql环境的安装.md\":\"CZgkNXUz\",\"frontend_vue3.md\":\"B7tXv4o1\",\"serverend_cloud-services_阿里云centos部署vue_node(express)_mysql_阿里云部署项目全过程.md\":\"BXU6W6xA\",\"serverend_cloud-services_云服务器通过vnc搭建ubuntu安装图形界面.md\":\"391ZSgDW\",\"serverend_docker.md\":\"egWphtks\",\"serverend_cloud-services_利用云服务器搭建frp实现内网穿透.md\":\"BmCDB4DN\",\"serverend_mongodb.md\":\"DuWYK3lK\",\"serverend_nodejs_index.md\":\"CUH-KZb3\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"清白之月\",\"description\":\"你是否得到了期待的人生\",\"base\":\"/DocumentSite/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/hero-logo.svg\",\"siteTitle\":\"清白之月\",\"outline\":[1,6],\"search\":{\"provider\":\"local\"},\"nav\":[{\"text\":\"前端\",\"items\":[{\"text\":\"VUE 2.x\",\"link\":\"/frontend/vue2.md\"},{\"text\":\"VUE 3.x\",\"link\":\"/frontend/vue3.md\"}]},{\"text\":\"服务端\",\"items\":[{\"text\":\"Nodejs\",\"link\":\"serverend/Nodejs/index.md\"},{\"text\":\"Mongodb\",\"link\":\"/serverend/mongodb.md\"},{\"text\":\"云服务\",\"link\":\"/serverend/cloud-services/README.md\"},{\"text\":\"Mysql\",\"link\":\"/serverend/index.md\"},{\"text\":\"Docker\",\"link\":\"/serverend/docker.md\"}]},{\"text\":\"工具类\",\"link\":\"/\"},{\"text\":\"前沿技术\",\"link\":\"/\"},{\"text\":\"随笔\",\"link\":\"/\"}],\"sidebar\":[{\"text\":\"前端\",\"collapsed\":false,\"items\":[{\"text\":\"Vue 2.x\",\"link\":\"/frontend/vue2.md\"},{\"text\":\"Vue 3.x\",\"link\":\"/frontend/vue3.md\"},{\"text\":\"Nodejs\",\"link\":\"/frontend/nodejs.md\"}]},{\"text\":\"服务端\",\"collapsed\":false,\"items\":[{\"text\":\"README\",\"link\":\"/serverend/README.md\"},{\"text\":\"Nodejs\",\"link\":\"/serverend/Nodejs/index.md\"},{\"text\":\"云服务\",\"link\":\"/serverend/cloud-services/README.md\"},{\"text\":\"Mongodb\",\"link\":\"/serverend/mongodb.md\"},{\"text\":\"Mysql\",\"link\":\"/serverend/index.md\"},{\"text\":\"Docker\",\"link\":\"/serverend/docker.md\"}]},{\"text\":\"工具类\",\"collapsed\":false,\"items\":[]},{\"text\":\"前沿技术\",\"collapsed\":false,\"items\":[]},{\"text\":\"随笔\",\"collapsed\":false,\"items\":[]}],\"footer\":{\"message\":\"As they floated in the breeze\",\"copyright\":\"Copyright © 2024-cheungchen\"},\"socialLinks\":[{\"icon\":{\"svg\":\"<svg t=\\\"1713408687091\\\" class=\\\"icon\\\" viewBox=\\\"0 0 1316 1024\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" p-id=\\\"7801\\\" width=\\\"64\\\" height=\\\"64\\\"><path d=\\\"M643.181714 247.698286l154.916572-123.172572L643.181714 0.256 643.072 0l-154.660571 124.269714 154.660571 123.245715 0.109714 0.182857z m0 388.461714h0.109715l399.579428-315.245714-108.361143-87.04-291.218285 229.888h-0.146286l-0.109714 0.146285L351.817143 234.093714l-108.251429 87.04 399.433143 315.136 0.146286-0.146285z m-0.146285 215.552l0.146285-0.146286 534.893715-422.034285 108.397714 87.04-243.309714 192L643.145143 1024 10.422857 525.056 0 516.754286l108.251429-86.893715L643.035429 851.748571z\\\" fill=\\\"#1E80FF\\\" p-id=\\\"7802\\\"></path></svg>\"},\"link\":\"https://juejin.cn\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>